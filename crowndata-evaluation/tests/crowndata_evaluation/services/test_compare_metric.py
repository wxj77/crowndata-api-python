import pytest
from crowndata_evaluation.services.compare_metric import dual_state_similarity


@pytest.mark.parametrize(
    "traj_a, traj_b, similarity_score, cosine_similarity_score",
    [
        [
            [
                [
                    0.383574843,
                    0.0734695271,
                    0.551359415,
                    -2.89342165,
                    -0.198712066,
                    0.126990348,
                ],
                [
                    0.383757949,
                    0.0734741762,
                    0.552553594,
                    -2.89334679,
                    -0.201124683,
                    0.126930386,
                ],
                [
                    0.383574843,
                    0.0734695271,
                    0.551359415,
                    -2.89342165,
                    -0.198712066,
                    0.126990348,
                ],
                [
                    0.383757949,
                    0.0734741762,
                    0.552553594,
                    -2.89334679,
                    -0.201124683,
                    0.126930386,
                ],
                [
                    0.383574843,
                    0.0734695271,
                    0.551359415,
                    -2.89342165,
                    -0.198712066,
                    0.126990348,
                ],
                [
                    0.383757949,
                    0.0734741762,
                    0.552553594,
                    -2.89334679,
                    -0.201124683,
                    0.126930386,
                ],
            ],
            [
                [
                    0.383574843,
                    0.0734695271,
                    0.551359415,
                    -2.89342165,
                    -0.198712066,
                    0.126990348,
                ],
                [
                    0.383757949,
                    0.0734741762,
                    0.552553594,
                    -2.89334679,
                    -0.201124683,
                    0.126930386,
                ],
                [
                    0.383574843,
                    0.0734695271,
                    0.551359415,
                    -2.89342165,
                    -0.198712066,
                    0.126990348,
                ],
                [
                    0.383757949,
                    0.0734741762,
                    0.552553594,
                    -2.89334679,
                    -0.201124683,
                    0.126930386,
                ],
                [
                    0.383574843,
                    0.0734695271,
                    0.551359415,
                    -2.89342165,
                    -0.198712066,
                    0.126990348,
                ],
                [
                    0.383757949,
                    0.0734741762,
                    0.552553594,
                    -2.89334679,
                    -0.201124683,
                    0.126930386,
                ],
            ],
            1,
            1,
        ],
        [
            [
                [
                    0.383574843,
                    0.0734695271,
                    0.551359415,
                    -2.89342165,
                    -0.198712066,
                    0.126990348,
                ],
                [
                    0.383757949,
                    0.0734741762,
                    0.552553594,
                    -2.89334679,
                    -0.201124683,
                    0.126930386,
                ],
                [
                    0.383574843,
                    0.0734695271,
                    0.551359415,
                    -2.89342165,
                    -0.198712066,
                    0.126990348,
                ],
                [
                    0.383757949,
                    0.0734741762,
                    0.552553594,
                    -2.89334679,
                    -0.201124683,
                    0.126930386,
                ],
                [
                    0.383574843,
                    0.0734695271,
                    0.551359415,
                    -2.89342165,
                    -0.198712066,
                    0.126990348,
                ],
                [
                    0.383757949,
                    0.0734741762,
                    0.552553594,
                    -2.89334679,
                    -0.201124683,
                    0.126930386,
                ],
            ],
            [
                [
                    0.383574843,
                    0.0734695271,
                    0.551359415,
                    -2.89342165,
                    -0.198712066,
                    0.126990348,
                ],
                [
                    0.383757949,
                    0.0734741762,
                    0.552553594,
                    -2.89334679,
                    -0.201124683,
                    0.126930386,
                ],
                [
                    0.383574843,
                    0.0734695271,
                    0.551359415,
                    -2.89342165,
                    -0.198712066,
                    0.126990348,
                ],
                [
                    0.383757949,
                    0.0734741762,
                    0.552553594,
                    -2.89334679,
                    -0.201124683,
                    0.126930386,
                ],
                [
                    0.383574843,
                    0.0734695271,
                    0.551359415,
                    -2.89342165,
                    -0.198712066,
                    0.126990348,
                ],
                [
                    0.5,
                    0.5,
                    0.5,
                    0.5,
                    0.5,
                    0.5,
                ],
            ],
            0.764,
            0.945,
        ],
    ],
)
def test_dual_state_similarity(
    traj_a, traj_b, similarity_score, cosine_similarity_score
):
    actual_similarity_score, actual_cosine_similarity_score = dual_state_similarity(
        traj_a, traj_b
    )
    assert actual_similarity_score == pytest.approx(similarity_score, 0.001)
    assert actual_cosine_similarity_score == pytest.approx(
        cosine_similarity_score, 0.001
    )
